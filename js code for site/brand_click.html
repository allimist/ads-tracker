<script>
// code send postback with brand click event , if you want prevent iphone pop ask chat gpt 
// add class cta to the link wrapper html element
// update var postbackUrl = "https://db.your-domain.com/in/?"    
// link can contain &brand=brand-name&link_type=link-type-popup
jQuery(document).ready(function($) {

    $(document).on('click', '.cta a', function(e) {
        e.preventDefault();

        var ctaUrl = $(this).attr('href');

        // --- ✅ Extract "brand" from CTA URL query parameter ---
        var brandParam = "";
			  var linktypeParam = "";
        try {
            var urlObj = new URL(ctaUrl, window.location.origin);
            brandParam = urlObj.searchParams.get("brand") || "";
					  linktypeParam = urlObj.searchParams.get("link_type") || "";
        } catch (err) {
            console.error("Invalid CTA URL:", err);
        }

        // --- Helper: get cookie value ---
        function getCookie(name) {
            var m = document.cookie.match(new RegExp("(?:^|; )" + name + "=([^;]*)"));
            return m ? decodeURIComponent(m[1]) : "";
        }

        // --- Read values from cookies ---
        var params = {
            gclid: getCookie("gclid"),
            campaignid: getCookie("campaignid"),
            page_url: getCookie("page_url"),
            adgroupid: getCookie("adgroupid"),
            keyword: getCookie("keyword"),
            device: getCookie("device"),
            source: getCookie("source"),
            event_id: getCookie("se")
        };

        // --- Build postback URL ---
        var postbackUrl = "https://db.your-domain.com/in/?" +
            "record_source=site" +
            "&event_type=brandclick" +
            "&brand=" + encodeURIComponent(brandParam) + 
						"&link_type=" + encodeURIComponent(linktypeParam) + 
            "&gclid=" + encodeURIComponent(params.gclid) +
            "&campaignid=" + encodeURIComponent(params.campaignid) +
            "&page_url=" + encodeURIComponent(params.page_url) +
            "&adgroupid=" + encodeURIComponent(params.adgroupid) +
            "&keyword=" + encodeURIComponent(params.keyword) +
            "&device=" + encodeURIComponent(params.device) +
            "&source=" + encodeURIComponent(params.source) +
            "&event_id=" + encodeURIComponent(params.event_id);
			
        // --- ✅ Send synchronous postback (blocking) ---
        try {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", postbackUrl, false); // false = synchronous
            xhr.send(null);
        } catch (err) {
            console.error("Postback failed:", err);
        }

        // --- ✅ Open CTA after postback (user-initiated) ---
        window.open(ctaUrl, '_blank');
    });

});
</script>
